<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>settings | midnight</title>
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/sidebar.css">
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/themes.css">
  <link rel="stylesheet" href="css/wallpaper.css">
  <link rel="stylesheet" href="css/accessibility.css">
  <link rel="stylesheet" href="css/animations.css">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* Settings-specific styles */
    .settings-container {
      margin-bottom: 50px;
    }
    
    .settings-section {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
    }
    
    .settings-section-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .settings-section-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: rgba(58, 174, 252, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      color: var(--color-blue);
      font-size: 20px;
    }
    
    .settings-section-title {
      font-size: 20px;
      font-weight: 700;
    }
    
    /* Theme Settings */
    .theme-selector {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .theme-preview {
      width: 100%;
      height: 120px;
      border-radius: 16px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: var(--transition-default);
      position: relative;
      overflow: hidden;
    }
    
    .theme-preview:hover {
      transform: scale(1.05);
      border: 1px solid var(--accent-color);
    }
    
    .theme-preview.active {
      border: 2px solid var(--accent-color);
    }
    
    .page-theme-selector {
      margin-top: 30px;
    }
    
    .page-theme-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    
    .page-theme-title {
      font-size: 16px;
      font-weight: 700;
    }
    
    .page-theme-reset {
      font-size: 14px;
      color: var(--color-blue);
      cursor: pointer;
      transition: var(--transition-default);
    }
    
    .page-theme-reset:hover {
      text-decoration: underline;
    }
    
    /* Wallpaper Settings */
    .wallpaper-preview-container {
      height: 200px;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 30px;
      position: relative;
    }
    
    .wallpaper-preview {
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      transition: var(--transition-default);
    }
    
    .wallpaper-preview::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-gradient);
      opacity: 0.7;
    }
    
    .wallpaper-name {
      position: absolute;
      bottom: 20px;
      left: 20px;
      z-index: 1;
      font-size: 18px;
      font-weight: 700;
      color: white;
      text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    }
    
    .wallpaper-nav {
      position: absolute;
      bottom: 20px;
      right: 20px;
      z-index: 1;
      display: flex;
      gap: 10px;
    }
    
    .wallpaper-nav-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition-default);
    }
    
    .wallpaper-nav-btn:hover {
      background: var(--color-blue);
    }
    
    /* Accessibility Settings */
    .settings-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .settings-option:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    
    .settings-option-label {
      display: flex;
      flex-direction: column;
    }
    
    .settings-option-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .settings-option-description {
      font-size: 14px;
      opacity: 0.7;
    }
    
    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.3);
      transition: var(--transition-default);
      border-radius: 24px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: var(--transition-default);
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background-color: var(--color-blue);
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }
    
    /* Data Management */
    .data-management-buttons {
      display: flex;
      gap: 15px;
    }
    
    .data-button {
      padding: 12px 24px;
      border-radius: 20px;
      background: rgba(0, 0, 0, 0.3);
      color: var(--text-color);
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition-default);
      border: none;
      font-family: 'Inter', sans-serif;
      text-transform: lowercase;
    }
    
    .data-button:hover {
      transform: translateY(-2px);
      background: rgba(58, 174, 252, 0.3);
    }
    
    .data-button.primary {
      background: var(--color-blue);
      color: white;
    }
    
    .data-button.primary:hover {
      box-shadow: 0 5px 15px var(--color-blue-glow);
    }
    
    /* Proxy Settings */
    .proxy-url-input {
      width: 100%;
      padding: 12px 15px;
      border-radius: 10px;
      border: none;
      background: rgba(0, 0, 0, 0.3);
      color: var(--text-color);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      margin-bottom: 15px;
    }
    
    .proxy-url-input:focus {
      outline: none;
      box-shadow: 0 0 10px var(--color-blue-glow);
    }
    
    /* File Input (hidden) */
    .file-input {
      display: none;
    }
  </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body class="theme-deep-blue">
  <div class="app-container">
    <!-- Sidebar -->
    <div class="sidebar-container"></div>
    
    <!-- Content -->
    <div class="content">
      <div class="container">
        <!-- Header -->
        <div class="header-container"></div>
        
        <!-- Settings Container -->
        <div class="settings-container">
          <!-- Theme Settings -->
          <div class="settings-section">
            <div class="settings-section-header">
              <div class="settings-section-icon">
                <i class="fa-solid fa-palette"></i>
              </div>
              <div class="settings-section-title">theme</div>
            </div>
            
            <div class="theme-selector" id="global-theme-selector">
              <!-- Theme previews will be populated by JavaScript -->
            </div>
            
            <div class="page-theme-selector">
              <div class="page-theme-header">
                <div class="page-theme-title">home page theme</div>
                <div class="page-theme-reset" data-page="index">reset to global</div>
              </div>
              <div class="theme-selector" id="index-theme-selector">
                <!-- Theme previews will be populated by JavaScript -->
              </div>
            </div>
            
            <div class="page-theme-selector">
              <div class="page-theme-header">
                <div class="page-theme-title">games page theme</div>
                <div class="page-theme-reset" data-page="g">reset to global</div>
              </div>
              <div class="theme-selector" id="g-theme-selector">
                <!-- Theme previews will be populated by JavaScript -->
              </div>
            </div>
            
            <div class="page-theme-selector">
              <div class="page-theme-header">
                <div class="page-theme-title">apps page theme</div>
                <div class="page-theme-reset" data-page="a">reset to global</div>
              </div>
              <div class="theme-selector" id="a-theme-selector">
                <!-- Theme previews will be populated by JavaScript -->
              </div>
            </div>
            
            <div class="page-theme-selector">
              <div class="page-theme-header">
                <div class="page-theme-title">proxy page theme</div>
                <div class="page-theme-reset" data-page="p">reset to global</div>
              </div>
              <div class="theme-selector" id="p-theme-selector">
                <!-- Theme previews will be populated by JavaScript -->
              </div>
            </div>
          </div>
          
          <!-- Wallpaper Settings -->
          <div class="settings-section">
            <div class="settings-section-header">
              <div class="settings-section-icon">
                <i class="fa-solid fa-image"></i>
              </div>
              <div class="settings-section-title">wallpaper</div>
            </div>
            
            <div class="wallpaper-preview-container">
              <div class="wallpaper-preview" id="wallpaper-preview"></div>
              <div class="wallpaper-name" id="wallpaper-name">default gradient</div>
              <div class="wallpaper-nav">
                <div class="wallpaper-nav-btn" id="prev-wallpaper">
                  <i class="fa-solid fa-chevron-left"></i>
                </div>
                <div class="wallpaper-nav-btn" id="next-wallpaper">
                  <i class="fa-solid fa-chevron-right"></i>
                </div>
              </div>
            </div>
            
            <div class="wallpaper-selector" id="wallpaper-selector">
              <!-- Wallpaper previews will be populated by JavaScript -->
            </div>
          </div>
          
          <!-- Homepage Settings -->
          <div class="settings-section">
            <div class="settings-section-header">
              <div class="settings-section-icon">
                <i class="fa-solid fa-home"></i>
              </div>
              <div class="settings-section-title">homepage</div>
            </div>
            
            <div class="settings-option">
              <div class="settings-option-label">
                <div class="settings-option-title">show announcements</div>
                <div class="settings-option-description">display announcements section on homepage</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="show-announcements-toggle" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            
            <div class="settings-option">
              <div class="settings-option-label">
                <div class="settings-option-title">show notes</div>
                <div class="settings-option-description">display notes widget on homepage</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="show-notes-toggle" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            
            <div class="settings-option">
              <div class="settings-option-label">
                <div class="settings-option-title">show recent activity</div>
                <div class="settings-option-description">display recent activity section on homepage</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="show-recent-toggle" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          
          <!-- Accessibility Settings -->
          <div class="settings-section">
            <div class="settings-section-header">
              <div class="settings-section-icon">
                <i class="fa-solid fa-universal-access"></i>
              </div>
              <div class="settings-section-title">accessibility</div>
            </div>
            
            <div class="settings-option">
              <div class="settings-option-label">
                <div class="settings-option-title">animations</div>
                <div class="settings-option-description">enable animations throughout the interface</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="animations-toggle" checked>
                <span class="toggle-slider"></span>
              </label>
            </div>
            
            <div class="settings-option">
              <div class="settings-option-label">
                <div class="settings-option-title">reduce motion</div>
                <div class="settings-option-description">minimize animations throughout the interface</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="reduce-motion-toggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
            
            <div class="settings-option">
              <div class="settings-option-label">
                <div class="settings-option-title">high contrast</div>
                <div class="settings-option-description">increase contrast for better visibility</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="high-contrast-toggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
            
            <div class="settings-option">
              <div class="settings-option-label">
                <div class="settings-option-title">compact spacing</div>
                <div class="settings-option-description">reduce padding and margins throughout the interface</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="compact-spacing-toggle">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          
          <!-- Data Management -->
          <div class="settings-section">
            <div class="settings-section-header">
              <div class="settings-section-icon">
                <i class="fa-solid fa-database"></i>
              </div>
              <div class="settings-section-title">data management</div>
            </div>
            
            <div class="settings-option">
              <div class="settings-option-label">
                <div class="settings-option-title">export/import settings</div>
                <div class="settings-option-description">save or load your settings configuration</div>
              </div>
              <div class="data-management-buttons">
                <button class="data-button" id="export-settings">export</button>
                <button class="data-button" id="import-settings">import</button>
                <input type="file" id="import-file" class="file-input" accept=".json">
              </div>
            </div>
            
            <div class="settings-option">
              <div class="settings-option-label">
                <div class="settings-option-title">reset all settings</div>
                <div class="settings-option-description">restore all settings to default values</div>
              </div>
              <button class="data-button" id="reset-settings">reset</button>
            </div>
          </div>
          
          <!-- Proxy Settings -->
          <div class="settings-section">
            <div class="settings-section-header">
              <div class="settings-section-icon">
                <i class="fa-solid fa-globe"></i>
              </div>
              <div class="settings-section-title">proxy settings</div>
            </div>
            
            <div class="settings-option">
              <div class="settings-option-label">
                <div class="settings-option-title">proxy url</div>
                <div class="settings-option-description">set the url prefix for the proxy service</div>
              </div>
            </div>
            
            <input type="text" class="proxy-url-input" id="proxy-url-input" placeholder="https://link.com/">
            
            <button class="data-button primary" id="save-proxy-url">save</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Scripts -->
  <script src="js/theme.js"></script>
  <script src="js/wallpaper.js"></script>
  <script src="js/sidebar.js"></script>
  <script src="js/header.js"></script>
  <script src="js/main.js"></script>
  
  <script>
    // Settings functionality
    document.addEventListener('DOMContentLoaded', () => {
      // DOM elements
      const globalThemeSelector = document.getElementById('global-theme-selector');
      const indexThemeSelector = document.getElementById('index-theme-selector');
      const gThemeSelector = document.getElementById('g-theme-selector');
      const aThemeSelector = document.getElementById('a-theme-selector');
      const pThemeSelector = document.getElementById('p-theme-selector');
      const pageThemeResets = document.querySelectorAll('.page-theme-reset');
      
      const wallpaperPreview = document.getElementById('wallpaper-preview');
      const wallpaperName = document.getElementById('wallpaper-name');
      const prevWallpaperBtn = document.getElementById('prev-wallpaper');
      const nextWallpaperBtn = document.getElementById('next-wallpaper');
      const wallpaperSelector = document.getElementById('wallpaper-selector');
      
      const reduceMotionToggle = document.getElementById('reduce-motion-toggle');
      const highContrastToggle = document.getElementById('high-contrast-toggle');
      const compactSpacingToggle = document.getElementById('compact-spacing-toggle');
      
      const exportSettingsBtn = document.getElementById('export-settings');
      const importSettingsBtn = document.getElementById('import-settings');
      const importFileInput = document.getElementById('import-file');
      const resetSettingsBtn = document.getElementById('reset-settings');
      
      const proxyUrlInput = document.getElementById('proxy-url-input');
      const saveProxyUrlBtn = document.getElementById('save-proxy-url');
      
      // State
      let currentWallpaperIndex = 0;
      let wallpapers = [];
      let accessibilitySettings = loadAccessibilitySettings();
      let homepageSettings = loadHomepageSettings();
      
      // Initialize settings
      initThemeSelectors();
      initWallpaperSelector();
      initAccessibilitySettings();
      initProxySettings();
      
      // Initialize theme selectors
      function initThemeSelectors() {
        const themes = ['deep-blue', 'midnight-neon', 'slate', 'aqua-haze'];
        
        // Global theme selector
        createThemeSelector(globalThemeSelector, themes, window.themeManager.currentTheme, (theme) => {
          window.themeManager.setTheme(theme);
        });
        
        // Page-specific theme selectors
        createThemeSelector(indexThemeSelector, themes, window.themeManager.pageThemes['index'] || window.themeManager.currentTheme, (theme) => {
          window.themeManager.setPageTheme('index', theme);
        });
        
        createThemeSelector(gThemeSelector, themes, window.themeManager.pageThemes['g'] || window.themeManager.currentTheme, (theme) => {
          window.themeManager.setPageTheme('g', theme);
        });
        
        createThemeSelector(aThemeSelector, themes, window.themeManager.pageThemes['a'] || window.themeManager.currentTheme, (theme) => {
          window.themeManager.setPageTheme('a', theme);
        });
        
        createThemeSelector(pThemeSelector, themes, window.themeManager.pageThemes['p'] || window.themeManager.currentTheme, (theme) => {
          window.themeManager.setPageTheme('p', theme);
        });
      }
      
      // Create theme selector
      function createThemeSelector(container, themes, activeTheme, callback) {
        container.innerHTML = '';
        
        themes.forEach(theme => {
          const themePreview = document.createElement('div');
          themePreview.className = `theme-preview theme-${theme}`;
          
          if (theme === activeTheme) {
            themePreview.classList.add('active');
          }
          
          const inner = document.createElement('div');
          inner.className = 'theme-preview-inner';
          inner.textContent = theme.replace('-', ' ');
          
          const indicator = document.createElement('div');
          indicator.className = 'accent-indicator';
          
          themePreview.appendChild(inner);
          themePreview.appendChild(indicator);
          
          themePreview.addEventListener('click', () => {
            // Update active state
            container.querySelectorAll('.theme-preview').forEach(el => {
              el.classList.remove('active');
            });
            themePreview.classList.add('active');
            
            // Call callback
            if (typeof callback === 'function') {
              callback(theme);
            }
          });
          
          container.appendChild(themePreview);
        });
      }
      
      // Initialize wallpaper selector
      function initWallpaperSelector() {
        // Get wallpapers
        wallpapers = window.wallpaperManager.wallpapers;
        
        // Set current wallpaper
        const currentWallpaper = window.wallpaperManager.currentWallpaper;
        currentWallpaperIndex = wallpapers.findIndex(w => w.id === currentWallpaper);
        
        if (currentWallpaperIndex === -1) {
          currentWallpaperIndex = 0;
        }
        
        updateWallpaperPreview();
        
        // Create wallpaper selector
        window.wallpaperManager.createWallpaperSelector(wallpaperSelector, (id) => {
          window.wallpaperManager.setWallpaper(id);
          
          // Update current index
          currentWallpaperIndex = wallpapers.findIndex(w => w.id === id);
          updateWallpaperPreview();
        });
      }
      
      // Update wallpaper preview
      function updateWallpaperPreview() {
        const wallpaper = wallpapers[currentWallpaperIndex];
        
        if (wallpaper.type === 'image' && wallpaper.url) {
          wallpaperPreview.style.backgroundImage = `url(${wallpaper.url})`;
        } else {
          wallpaperPreview.style.backgroundImage = 'none';
        }
        
        wallpaperName.textContent = wallpaper.name;
      }
      
      // Initialize accessibility settings
      function initAccessibilitySettings() {
        // Animation settings
        const animationsToggle = document.getElementById('animations-toggle');
        animationsToggle.checked = accessibilitySettings.animations !== false; // Default to true
        
        reduceMotionToggle.checked = accessibilitySettings.reduceMotion;
        highContrastToggle.checked = accessibilitySettings.highContrast;
        compactSpacingToggle.checked = accessibilitySettings.compactSpacing;
        
        // Homepage module settings
        const showAnnouncementsToggle = document.getElementById('show-announcements-toggle');
        const showNotesToggle = document.getElementById('show-notes-toggle');
        const showRecentToggle = document.getElementById('show-recent-toggle');
        
        showAnnouncementsToggle.checked = homepageSettings.showAnnouncements !== false; // Default to true
        showNotesToggle.checked = homepageSettings.showNotes !== false; // Default to true
        showRecentToggle.checked = homepageSettings.showRecent !== false; // Default to true
        
        // Apply settings
        applyAccessibilitySettings();
        
        // Event listeners for homepage settings
        showAnnouncementsToggle.addEventListener('change', () => {
          homepageSettings.showAnnouncements = showAnnouncementsToggle.checked;
          saveHomepageSettings();
        });
        
        showNotesToggle.addEventListener('change', () => {
          homepageSettings.showNotes = showNotesToggle.checked;
          saveHomepageSettings();
        });
        
        showRecentToggle.addEventListener('change', () => {
          homepageSettings.showRecent = showRecentToggle.checked;
          saveHomepageSettings();
        });
        
        // Event listener for animations toggle
        animationsToggle.addEventListener('change', () => {
          accessibilitySettings.animations = animationsToggle.checked;
          saveAccessibilitySettings();
          applyAccessibilitySettings();
        });
      }
      
      // Load accessibility settings
      function loadAccessibilitySettings() {
        const saved = localStorage.getItem('midnight_accessibility');
        return saved ? JSON.parse(saved) : {
          animations: true,
          reduceMotion: false,
          highContrast: false,
          compactSpacing: false
        };
      }
      
      // Load homepage settings
      function loadHomepageSettings() {
        const saved = localStorage.getItem('midnight_homepage_settings');
        return saved ? JSON.parse(saved) : {
          showAnnouncements: true,
          showNotes: true,
          showRecent: true
        };
      }
      
      // Save accessibility settings
      function saveAccessibilitySettings() {
        localStorage.setItem('midnight_accessibility', JSON.stringify(accessibilitySettings));
      }
      
      // Save homepage settings
      function saveHomepageSettings() {
        localStorage.setItem('midnight_homepage_settings', JSON.stringify(homepageSettings));
      }
      
      // Apply accessibility settings
      function applyAccessibilitySettings() {
        // Animations
        if (accessibilitySettings.animations === false) {
          document.body.classList.add('no-animations');
        } else {
          document.body.classList.remove('no-animations');
        }
        
        // Reduce motion
        if (accessibilitySettings.reduceMotion) {
          document.body.classList.add('reduce-motion');
        } else {
          document.body.classList.remove('reduce-motion');
        }
        
        // High contrast
        if (accessibilitySettings.highContrast) {
          document.body.classList.add('high-contrast');
        } else {
          document.body.classList.remove('high-contrast');
        }
        
        // Compact spacing
        if (accessibilitySettings.compactSpacing) {
          document.body.classList.add('compact-spacing');
        } else {
          document.body.classList.remove('compact-spacing');
        }
      }
      
      // Initialize proxy settings
      function initProxySettings() {
        const proxyUrl = localStorage.getItem('midnight_proxy_url') || '';
        proxyUrlInput.value = proxyUrl;
      }
      
      // Save proxy URL
      function saveProxyUrl() {
        const url = proxyUrlInput.value.trim();
        localStorage.setItem('midnight_proxy_url', url);
        
        // Show success message
        alert('Proxy URL saved successfully');
      }
      
      // Export settings
      function exportSettings() {
        const settings = {
          theme: {
            global: window.themeManager.currentTheme,
            pages: window.themeManager.pageThemes
          },
          wallpaper: {
            global: window.wallpaperManager.currentWallpaper,
            pages: window.wallpaperManager.pageWallpapers
          },
          accessibility: accessibilitySettings,
          proxy: {
            url: localStorage.getItem('midnight_proxy_url') || ''
          }
        };
        
        const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = 'midnight_settings.json';
        a.click();
        
        URL.revokeObjectURL(url);
      }
      
      // Import settings
      function importSettings(file) {
        const reader = new FileReader();
        
        reader.onload = (e) => {
          try {
            const settings = JSON.parse(e.target.result);
            
            // Import theme settings
            if (settings.theme) {
              if (settings.theme.global) {
                window.themeManager.setTheme(settings.theme.global);
              }
              
              if (settings.theme.pages) {
                Object.entries(settings.theme.pages).forEach(([page, theme]) => {
                  window.themeManager.setPageTheme(page, theme);
                });
              }
            }
            
            // Import wallpaper settings
            if (settings.wallpaper) {
              if (settings.wallpaper.global) {
                window.wallpaperManager.setWallpaper(settings.wallpaper.global);
              }
              
              if (settings.wallpaper.pages) {
                Object.entries(settings.wallpaper.pages).forEach(([page, wallpaper]) => {
                  window.wallpaperManager.setPageWallpaper(page, wallpaper);
                });
              }
            }
            
            // Import accessibility settings
            if (settings.accessibility) {
              accessibilitySettings = settings.accessibility;
              saveAccessibilitySettings();
              initAccessibilitySettings();
            }
            
            // Import proxy settings
            if (settings.proxy && settings.proxy.url !== undefined) {
              localStorage.setItem('midnight_proxy_url', settings.proxy.url);
              proxyUrlInput.value = settings.proxy.url;
            }
            
            // Reload page to apply settings
            alert('Settings imported successfully. Page will reload to apply changes.');
            setTimeout(() => {
              window.location.reload();
            }, 1000);
          } catch (error) {
            console.error('Error importing settings:', error);
            alert('Error importing settings. Please check the file format.');
          }
        };
        
        reader.readAsText(file);
      }
      
      // Reset settings
      function resetSettings() {
        if (confirm('Are you sure you want to reset all settings to default values?')) {
          // Reset theme settings
          localStorage.removeItem('midnight_theme');
          localStorage.removeItem('midnight_page_themes');
          
          // Reset wallpaper settings
          localStorage.removeItem('midnight_wallpaper');
          localStorage.removeItem('midnight_page_wallpapers');
          
          // Reset accessibility settings
          localStorage.removeItem('midnight_accessibility');
          
          // Reset proxy settings
          localStorage.removeItem('midnight_proxy_url');
          
          // Reload page to apply settings
          alert('All settings have been reset to default values. Page will reload to apply changes.');
          setTimeout(() => {
            window.location.reload();
          }, 1000);
        }
      }
      
      // Event listeners
      prevWallpaperBtn.addEventListener('click', () => {
        currentWallpaperIndex = (currentWallpaperIndex - 1 + wallpapers.length) % wallpapers.length;
        updateWallpaperPreview();
        window.wallpaperManager.setWallpaper(wallpapers[currentWallpaperIndex].id);
      });
      
      nextWallpaperBtn.addEventListener('click', () => {
        currentWallpaperIndex = (currentWallpaperIndex + 1) % wallpapers.length;
        updateWallpaperPreview();
        window.wallpaperManager.setWallpaper(wallpapers[currentWallpaperIndex].id);
      });
      
      reduceMotionToggle.addEventListener('change', () => {
        accessibilitySettings.reduceMotion = reduceMotionToggle.checked;
        saveAccessibilitySettings();
        applyAccessibilitySettings();
      });
      
      highContrastToggle.addEventListener('change', () => {
        accessibilitySettings.highContrast = highContrastToggle.checked;
        saveAccessibilitySettings();
        applyAccessibilitySettings();
      });
      
      compactSpacingToggle.addEventListener('change', () => {
        accessibilitySettings.compactSpacing = compactSpacingToggle.checked;
        saveAccessibilitySettings();
        applyAccessibilitySettings();
      });
      
      exportSettingsBtn.addEventListener('click', exportSettings);
      
      importSettingsBtn.addEventListener('click', () => {
        importFileInput.click();
      });
      
      importFileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          importSettings(e.target.files[0]);
        }
      });
      
      resetSettingsBtn.addEventListener('click', resetSettings);
      
      saveProxyUrlBtn.addEventListener('click', saveProxyUrl);
      
      // Page theme reset buttons
      pageThemeResets.forEach(resetBtn => {
        resetBtn.addEventListener('click', () => {
          const page = resetBtn.dataset.page;
          window.themeManager.resetPageTheme(page);
          
          // Reload theme selectors
          initThemeSelectors();
        });
      });
    });
  </script>
</body>
</html>

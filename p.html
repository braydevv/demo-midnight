<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>proxy | midnight</title>
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/sidebar.css">
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/themes.css">
  <link rel="stylesheet" href="css/wallpaper.css">
  <link rel="stylesheet" href="css/accessibility.css">
  <link rel="stylesheet" href="css/animations.css">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* Proxy-specific styles */
    .proxy-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 80px);
      border-radius: 16px;
      overflow: hidden;
      background: var(--card-bg);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      margin-top: -20px;
    }
    
    .header-container {
      display: none;
    }
    
    /* Tab Bar */
    .tab-bar {
      display: flex;
      align-items: center;
      background: rgba(0, 0, 0, 0.2);
      padding: 10px;
      overflow-x: auto;
      scrollbar-width: thin;
    }
    
    .tab-bar::-webkit-scrollbar {
      height: 5px;
    }
    
    .tab-bar::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .tab-bar::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 5px;
    }
    
    .tab {
      display: flex;
      align-items: center;
      padding: 8px 15px;
      margin-right: 5px;
      cursor: pointer;
      transition: var(--transition-default);
      white-space: nowrap;
      position: relative;
      min-width: 100px;
      border-radius: 0;
    }
    
    .tab.active {
      background: rgba(58, 174, 252, 0.1);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 0;
      width: 100%;
      height: 2px;
      background: var(--color-blue);
    }
    
    .tab-title {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .tab-close {
      margin-left: 10px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      opacity: 0.5;
      transition: var(--transition-default);
    }
    
    .tab:hover .tab-close {
      opacity: 1;
      background: rgba(255, 255, 255, 0.1);
    }
    
    .new-tab {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: var(--transition-default);
      flex-shrink: 0;
    }
    
    .new-tab:hover {
      background: rgba(58, 174, 252, 0.3);
    }
    
    /* Omnibox */
    .omnibox-container {
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
    }
    
    .omnibox {
      flex: 1;
      padding: 10px 15px;
      border-radius: 16px;
      border: none;
      background: rgba(0, 0, 0, 0.3);
      color: var(--text-color);
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      transition: var(--transition-default);
      text-transform: lowercase;
    }
    
    .omnibox:focus {
      outline: none;
      border: 1px solid rgba(58, 174, 252, 0.3);
    }
    
    .omnibox-actions {
      display: flex;
      margin-left: 10px;
    }
    
    .omnibox-action {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: var(--transition-default);
      margin-left: 5px;
    }
    
    .omnibox-action:hover {
      background: rgba(58, 174, 252, 0.3);
    }
    
    /* Content Area */
    .content-area {
      flex: 1;
      position: relative;
      background: #000;
    }
    
    .iframe-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .iframe-container.active {
      opacity: 1;
      z-index: 1;
    }
    
    .proxy-iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    /* Loading Indicator */
    .loading-indicator {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: rgba(0, 0, 0, 0.3);
      z-index: 10;
    }
    
    .loading-bar {
      height: 100%;
      width: 0;
      background: var(--color-blue);
      box-shadow: 0 0 10px var(--color-blue-glow);
      transition: width 0.2s ease;
    }
    
    .loading-bar.animate {
      animation: loading 2s ease infinite;
    }
    
    @keyframes loading {
      0% { width: 0; }
      50% { width: 70%; }
      100% { width: 100%; }
    }
    
    /* Theme Selector */
    .tab-theme-selector {
      position: absolute;
      top: 60px;
      right: 10px;
      background: var(--card-bg);
      border-radius: 20px;
      padding: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      z-index: 100;
      width: 250px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: var(--transition-default);
    }
    
    .tab-theme-selector.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .tab-theme-selector h3 {
      margin-bottom: 10px;
      font-size: 16px;
    }
    
    .tab-theme-colors {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
    }
    
    .tab-theme-color {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      transition: var(--transition-default);
    }
    
    .tab-theme-color:hover {
      transform: scale(1.1);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }
    
    /* Empty State */
    .empty-state {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.3);
      z-index: 0;
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    .empty-state-text {
      font-size: 18px;
      opacity: 0.5;
    }
  </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body class="theme-deep-blue">
  <div class="app-container">
    <!-- Sidebar -->
    <div class="sidebar-container"></div>
    
    <!-- Content -->
    <div class="content">
      <div class="container">
        <!-- Header -->
        <div class="header-container"></div>
        
        <!-- Proxy Container -->
        <div class="proxy-container">
          <!-- Tab Bar -->
          <div class="tab-bar" id="tab-bar">
            <!-- Tabs will be populated by JavaScript -->
            <div class="new-tab" id="new-tab">
              <i class="fa-solid fa-plus"></i>
            </div>
          </div>
          
          <!-- Omnibox -->
          <div class="omnibox-container">
            <input type="text" class="omnibox" id="omnibox" placeholder="type a site or search..." />
            <div class="omnibox-actions">
              <div class="omnibox-action" id="refresh-page">
                <i class="fa-solid fa-rotate-right"></i>
              </div>
              <div class="omnibox-action" id="tab-settings">
                <i class="fa-solid fa-palette"></i>
              </div>
            </div>
          </div>
          
          <!-- Loading Indicator -->
          <div class="loading-indicator">
            <div class="loading-bar" id="loading-bar"></div>
          </div>
          
          <!-- Content Area -->
          <div class="content-area" id="content-area">
            <!-- Empty State -->
            <div class="empty-state" id="empty-state">
              <div class="empty-state-icon">
                <i class="fa-solid fa-globe"></i>
              </div>
              <div class="empty-state-text">type a url or search term to begin</div>
            </div>
            
            <!-- Iframes will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Tab Theme Selector -->
  <div class="tab-theme-selector" id="tab-theme-selector">
    <h3>tab accent color</h3>
    <div class="tab-theme-colors">
      <div class="tab-theme-color" style="background: #3aaefc;" data-color="#3aaefc"></div>
      <div class="tab-theme-color" style="background: #fc3a3a;" data-color="#fc3a3a"></div>
      <div class="tab-theme-color" style="background: #3afc4d;" data-color="#3afc4d"></div>
      <div class="tab-theme-color" style="background: #fc3ad1;" data-color="#fc3ad1"></div>
      <div class="tab-theme-color" style="background: #fcba3a;" data-color="#fcba3a"></div>
      <div class="tab-theme-color" style="background: #a13afc;" data-color="#a13afc"></div>
      <div class="tab-theme-color" style="background: #3afcee;" data-color="#3afcee"></div>
      <div class="tab-theme-color" style="background: #fc3a8f;" data-color="#fc3a8f"></div>
      <div class="tab-theme-color" style="background: #3a8ffc;" data-color="#3a8ffc"></div>
      <div class="tab-theme-color" style="background: #fc8f3a;" data-color="#fc8f3a"></div>
    </div>
  </div>
  
  <!-- Scripts -->
  <script src="js/theme.js"></script>
  <script src="js/wallpaper.js"></script>
  <script src="js/sidebar.js"></script>
  <script src="js/header.js"></script>
  <script src="js/main.js"></script>
  
  <script>
    // Proxy functionality
    document.addEventListener('DOMContentLoaded', () => {
      // Constants
      const PROXY_PREFIX = ''; // Will be set later
      const DEFAULT_ENGINE = 'duckduckgo.com/?q=';
      
      // DOM elements
      const tabBar = document.getElementById('tab-bar');
      const newTabBtn = document.getElementById('new-tab');
      const omnibox = document.getElementById('omnibox');
      const refreshBtn = document.getElementById('refresh-page');
      const tabSettingsBtn = document.getElementById('tab-settings');
      const contentArea = document.getElementById('content-area');
      const emptyState = document.getElementById('empty-state');
      const loadingBar = document.getElementById('loading-bar');
      const tabThemeSelector = document.getElementById('tab-theme-selector');
      
      // State
      let tabs = [];
      let activeTabId = null;
      
      // Load saved tabs
      loadTabs();
      
      // If no tabs, create a new one
      if (tabs.length === 0) {
        createNewTab();
      } else {
        renderTabs();
        activateTab(tabs[0].id);
      }
      
      // Create new tab
      function createNewTab() {
        const tabId = 'tab-' + Date.now();
        
        const newTab = {
          id: tabId,
          title: 'new tab',
          url: '',
          theme: '#3aaefc'
        };
        
        tabs.push(newTab);
        saveTabs();
        renderTabs();
        activateTab(tabId);
      }
      
      // Render tabs
      function renderTabs() {
        // Clear tab bar except for new tab button
        const children = Array.from(tabBar.children);
        children.forEach(child => {
          if (!child.classList.contains('new-tab')) {
            tabBar.removeChild(child);
          }
        });
        
        // Add tabs
        tabs.forEach(tab => {
          const tabElement = document.createElement('div');
          tabElement.className = 'tab';
          tabElement.dataset.id = tab.id;
          
          if (tab.id === activeTabId) {
            tabElement.classList.add('active');
            
            // Set active tab style
            document.documentElement.style.setProperty('--color-blue', tab.theme);
            document.documentElement.style.setProperty('--color-blue-glow', tab.theme + '66');
          }
          
          tabElement.innerHTML = `
            <div class="tab-title">${tab.title}</div>
            <div class="tab-close"><i class="fa-solid fa-times"></i></div>
          `;
          
          tabElement.addEventListener('click', (e) => {
            if (!e.target.closest('.tab-close')) {
              activateTab(tab.id);
            }
          });
          
          const closeBtn = tabElement.querySelector('.tab-close');
          closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            closeTab(tab.id);
          });
          
          tabBar.insertBefore(tabElement, newTabBtn);
        });
      }
      
      // Activate tab
      function activateTab(tabId) {
        activeTabId = tabId;
        const tab = tabs.find(t => t.id === tabId);
        
        if (!tab) return;
        
        // Update active tab in UI
        renderTabs();
        
        // Update omnibox
        omnibox.value = tab.url;
        
        // Update iframe visibility
        const iframes = contentArea.querySelectorAll('.iframe-container');
        iframes.forEach(iframe => {
          if (iframe.dataset.tabId === tabId) {
            iframe.classList.add('active');
          } else {
            iframe.classList.remove('active');
          }
        });
        
        // Hide empty state if tab has URL
        if (tab.url) {
          emptyState.style.display = 'none';
        } else {
          emptyState.style.display = 'flex';
        }
      }
      
      // Close tab
      function closeTab(tabId) {
        const tabIndex = tabs.findIndex(t => t.id === tabId);
        
        if (tabIndex === -1) return;
        
        // Remove iframe
        const iframe = contentArea.querySelector(`.iframe-container[data-tab-id="${tabId}"]`);
        if (iframe) {
          contentArea.removeChild(iframe);
        }
        
        // Remove tab
        tabs.splice(tabIndex, 1);
        
        // If closed tab was active, activate another tab
        if (activeTabId === tabId) {
          if (tabs.length > 0) {
            // Activate previous tab or first tab
            const newActiveIndex = Math.max(0, tabIndex - 1);
            activateTab(tabs[newActiveIndex].id);
          } else {
            // No tabs left, create a new one
            createNewTab();
          }
        }
        
        saveTabs();
        renderTabs();
      }
      
      // Navigate to URL
      function navigateTo(url) {
        if (!activeTabId) return;
        
        const tab = tabs.find(t => t.id === activeTabId);
        if (!tab) return;
        
        // Process URL
        const processedUrl = processUrl(url);
        
        // Update tab
        tab.url = url;
        tab.title = getDomainFromUrl(url) || 'new tab';
        
        // Create or update iframe
        let iframe = contentArea.querySelector(`.iframe-container[data-tab-id="${activeTabId}"]`);
        
        if (!iframe) {
          iframe = document.createElement('div');
          iframe.className = 'iframe-container active';
          iframe.dataset.tabId = activeTabId;
          
          const iframeElement = document.createElement('iframe');
          iframeElement.className = 'proxy-iframe';
          iframeElement.src = processedUrl;
          
          iframe.appendChild(iframeElement);
          contentArea.appendChild(iframe);
        } else {
          const iframeElement = iframe.querySelector('iframe');
          iframeElement.src = processedUrl;
        }
        
        // Show loading indicator
        showLoading();
        
        // Hide empty state
        emptyState.style.display = 'none';
        
        // Save tabs
        saveTabs();
        renderTabs();
      }
      
      // Process URL
      function processUrl(input) {
        input = input.trim().toLowerCase();
        
        // If empty, return empty
        if (!input) return '';
        
        // If it contains spaces or doesn't look like a domain, treat as search
        if (input.includes(' ') || !input.includes('.')) {
          return PROXY_PREFIX + DEFAULT_ENGINE + encodeURIComponent(input);
        }
        
        // If it doesn't start with http(s)://, add it
        if (!input.startsWith('http://') && !input.startsWith('https://')) {
          input = 'https://' + input;
        }
        
        return PROXY_PREFIX + input;
      }
      
      // Get domain from URL
      function getDomainFromUrl(url) {
        if (!url) return '';
        
        try {
          // Remove protocol
          let domain = url.replace(/^(https?:\/\/)?(www\.)?/, '');
          
          // Remove path
          domain = domain.split('/')[0];
          
          return domain;
        } catch (e) {
          return url;
        }
      }
      
      // Show loading indicator
      function showLoading() {
        loadingBar.classList.add('animate');
        
        setTimeout(() => {
          loadingBar.classList.remove('animate');
          loadingBar.style.width = '100%';
          
          setTimeout(() => {
            loadingBar.style.width = '0';
          }, 200);
        }, 1000);
      }
      
      // Save tabs to sessionStorage
      function saveTabs() {
        sessionStorage.setItem('midnight_proxy_tabs', JSON.stringify(tabs));
      }
      
      // Load tabs from sessionStorage
      function loadTabs() {
        const savedTabs = sessionStorage.getItem('midnight_proxy_tabs');
        tabs = savedTabs ? JSON.parse(savedTabs) : [];
      }
      
      // Set tab theme
      function setTabTheme(color) {
        if (!activeTabId) return;
        
        const tab = tabs.find(t => t.id === activeTabId);
        if (!tab) return;
        
        tab.theme = color;
        saveTabs();
        renderTabs();
      }
      
      // Event listeners
      newTabBtn.addEventListener('click', createNewTab);
      
      omnibox.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          navigateTo(omnibox.value);
        }
      });
      
      refreshBtn.addEventListener('click', () => {
        if (!activeTabId) return;
        
        const tab = tabs.find(t => t.id === activeTabId);
        if (!tab || !tab.url) return;
        
        navigateTo(tab.url);
      });
      
      tabSettingsBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        tabThemeSelector.classList.toggle('active');
      });
      
      document.addEventListener('click', (e) => {
        if (!tabThemeSelector.contains(e.target) && !tabSettingsBtn.contains(e.target)) {
          tabThemeSelector.classList.remove('active');
        }
      });
      
      // Tab theme color selection
      const themeColors = document.querySelectorAll('.tab-theme-color');
      themeColors.forEach(color => {
        color.addEventListener('click', () => {
          setTabTheme(color.dataset.color);
          tabThemeSelector.classList.remove('active');
        });
      });
      
      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Ctrl+T: New tab
        if (e.ctrlKey && e.key === 't') {
          e.preventDefault();
          createNewTab();
        }
        
        // Ctrl+W: Close tab
        if (e.ctrlKey && e.key === 'w') {
          e.preventDefault();
          if (activeTabId) {
            closeTab(activeTabId);
          }
        }
      });
    });
  </script>
</body>
</html>
